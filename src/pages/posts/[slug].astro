---
import type { GetStaticPaths } from "astro";
import { getCollection } from "astro:content";
import TableOfContents from "../../components/TableOfContents.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Footer from "../../components/Footer.astro";
import { generateToc } from "../../lib/toc";
import { cn, dateFormatter } from "../../lib/utils";

export const getStaticPaths = (async () => {
  const blog = await getCollection("posts");

  return blog.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content, remarkPluginFrontmatter, headings } = await entry.render();

const toc = generateToc(headings, 3);
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <article
    class={cn(
      "prose dark:prose-invert prose-theme max-w-none",
      "prose-h2:text-xl",
      "prose-headings:font-normal prose-headings:text-base prose-headings:mt-10 prose-headings:pt-6 prose-headings:mb-4",
      "prose-strong:border-b prose-strong:border-dashed dark:prose-strong:border-b-zinc-200 prose-strong:border-zinc-800 prose-strong:font-medium",
      "prose-inline-code:bg-zinc-50 dark:prose-inline-code:bg-zinc-800 dark:prose-inline-code:border-zinc-600 prose-inline-code:px-2 prose-inline-code:py-1 prose-inline-code:rounded-lg prose-inline-code:border prose-inline-code:after:content-[''] prose-inline-code:before:content-['']"
    )}
  >
    <div class="not-prose mb-12 space-y-16">
      <div class="flex items-center gap-6">
        <a
          href="/"
          class="group relative inline-block p-2 text-zinc-100 dark:text-zinc-900"
          aria-label="Go back to the home page"
        >
          <div
            class="absolute left-0 top-0 -z-20 h-full w-full origin-center rounded-full bg-zinc-800 dark:bg-zinc-100"
          >
          </div>
          <div
            class="absolute left-0 top-0 -z-10 h-full w-full origin-center scale-[2] rounded-full opacity-0 backdrop-blur-[2px] transition duration-300 ease-in-out group-hover:opacity-100"
          >
          </div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 16 16"
            fill="currentColor"
            class="size-4"
          >
            <path
              fill-rule="evenodd"
              d="M11.78 11.78a.75.75 0 0 0 0-1.06L6.56 5.5h3.69a.75.75 0 0 0 0-1.5h-5.5a.75.75 0 0 0-.75.75v5.5a.75.75 0 0 0 1.5 0V6.56l5.22 5.22a.75.75 0 0 0 1.06 0Z"
              clip-rule="evenodd"></path>
          </svg>
        </a>
        <header class="space-y-2">
          <h1 class="text-xl font-normal text-zinc-900 dark:text-zinc-100">
            {entry.data.title}
          </h1>
          <div class="flex gap-2 text-sm text-zinc-500 dark:text-zinc-400">
            <span>{dateFormatter.format(entry.data.pubDate)}</span>
            &bull;
            <span>{remarkPluginFrontmatter.minutesToRead}</span>
          </div>
        </header>
      </div>
      <nav class="space-y-2" aria-label="Table of contents">
        <TableOfContents {toc} />
      </nav>
    </div>
    <Content />
  </article>
  <Footer />
</BaseLayout>
